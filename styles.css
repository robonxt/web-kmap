/* K-Map Solver - Custom Styles
   Uses robonxt design system (tokens.css and components.css)
   This file contains K-map specific overrides and custom components
*/

/* Material Symbols support */
.material-symbols-rounded {
    font-family: 'Material Symbols Rounded', sans-serif;
    font-weight: normal;
    font-style: normal;
    font-size: 24px;
    line-height: 1;
    letter-spacing: normal;
    text-transform: none;
    display: inline-block;
    white-space: nowrap;
    word-wrap: normal;
    direction: ltr;
    font-feature-settings: 'liga';
    -webkit-font-feature-settings: 'liga';
    -webkit-font-smoothing: antialiased;
    vertical-align: middle;
    color: inherit;
}

.btn-icon .material-symbols-rounded,
.svg-button .material-symbols-rounded {
    font-size: 24px;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

/* K-Map Custom Variables */
:root {
    --max-width: 800px;
    --button-min-width: 40px;
}

[data-theme="light"] {
    --cell-selected-color: #bdffbd;
    --cell-dont-care-color: #fff0bf;
    --kmap-primary: #4CAF50;
    --kmap-primary-hover: #3498db;
}

[data-theme="dark"] {
    --cell-selected-color: #395c39;
    --cell-dont-care-color: #5a4f33;
    --kmap-primary: #4CAF50;
    --kmap-primary-hover: #3498db;
}

/* K-Map Specific Body Overrides */
body {
    margin: 0;
    max-height: 100vh;
    overscroll-behavior-y: contain;
}

/* Layout & Container Styles */
.container {
    flex: 1;
    width: 100%;
    max-width: var(--max-width);
    margin: 0 auto var(--space-xs);
    padding: 0 var(--space-xs) 0 var(--space-xs);
}

/* Header Navigation (following guidelines) */
.kmap-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--space-xs);
    background-color: var(--kmap-primary);
    border-bottom: var(--stroke-sm) solid var(--color-border-default);
    border-radius: var(--radius-md);
    position: sticky;
    top: 0;
    margin-bottom: var(--space-xs);
    z-index: 10;
    overflow: visible;
    box-shadow: var(--shadow-sm);
}

.kmap-header .btn-icon {
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.3);
    color: white;
}

.kmap-header .btn-icon:hover {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.5);
}

.header-nav {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    flex: 1;
    min-width: 0;
    position: relative;
}

.nav-toggle {
    display: none;
    flex-shrink: 0;
}

.nav-title {
    display: none;
    color: var(--color-text-high);
    font: var(--font-label);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    flex: 1;
    min-width: 0;
}

.nav-items {
    display: inline-flex;
}

/* Compact mode: when header is too narrow */
.header-nav.compact .nav-toggle {
    display: inline-flex;
}

.header-nav.compact .nav-title {
    display: block;
}

.header-nav.compact .nav-items {
    position: absolute;
    top: calc(100% + var(--space-xs));
    left: 0;
    display: flex;
    flex-direction: column;
    align-items: stretch;
    background: var(--color-surface);
    border: var(--stroke-sm) solid var(--color-border-default);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-md);
    padding: var(--space-xs);
    min-width: 200px;
    z-index: 60;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-8px);
    transition: opacity var(--duration-quick) var(--easing),
                transform var(--duration-quick) var(--easing),
                visibility 0s var(--duration-quick);
}

.header-nav.compact .nav-items.is-visible {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
    transition-delay: 0s;
}

.header-nav.compact .nav-items .pill-selector-slider {
    display: none;
}

.pill-selector-slider {
    position: absolute;
    background-color: var(--kmap-primary);
    border-radius: var(--radius-full);
    transition: left var(--duration-medium) var(--easing), width var(--duration-medium) var(--easing);
    z-index: 2;
    pointer-events: none;
}

.header-nav.compact .nav-items .btn-pill {
    width: 100%;
    text-align: left;
    justify-content: flex-start;
    border-radius: var(--radius-md);
    padding: var(--space-xs) var(--space-sm);
}

.header-nav.compact .nav-items .btn-pill.active {
    background-color: var(--color-surface-hover);
    color: var(--color-text-high);
}

.header-actions {
    display: flex;
    gap: var(--space-xs);
    align-items: center;
    flex-shrink: 0;
}

/* Common container properties */
.container-control,
.container-solution,
.tab-content-container {
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-sm);
    margin-bottom: var(--space-xs);
    padding: var(--space-xs);
    gap: var(--space-xs);
}

.container-control {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(var(--button-min-width), 1fr));
    background-color: var(--color-surface);
}

.container-solution {
    background-color: var(--color-surface);
}

.solution-toolbar {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    background-color: var(--color-surface);
    border: var(--stroke-sm) solid var(--color-border-default);
    border-radius: var(--radius-md);
    padding: var(--space-xs);
}

.solution-text {
    flex: 1;
    text-align: left;
    font-size: var(--font-size-h3);
    font-weight: var(--font-weight-semibold);
    color: var(--color-text-high);
    min-height: 1.5em;
}

.solution-dropdown {
    display: none;
}

.tab-content-container {
    background-color: var(--color-surface);
    display: none;
}

.tab-content-container.active {
    display: block;
}

/* K-Map Grid and Cells */
.kmap-groups-svg {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 1;
    overflow: visible;
}

.kmap-group-path {
    fill: none;
    stroke-width: 4;
    opacity: 0.8;
    transition: all var(--duration-quick) var(--easing);
}

.kmap-group-path[data-wrap="true"] {
    stroke-dasharray: 10 5;
}

.cell {
    aspect-ratio: 1;
    border: var(--stroke-sm) solid var(--color-border-default);
    border-radius: var(--radius-md);
    display: grid;
    grid-template-areas:
        "topleft topcenter topright"
        "midleft midcenter midright"
        "botleft botcenter botright";
    grid-template-columns: 1fr auto 1fr;
    grid-template-rows: auto 1fr auto;
    cursor: pointer;
    user-select: none;
    background-color: var(--color-surface);
    color: var(--color-text-high);
    transition: all var(--duration-quick) var(--easing);
    padding: var(--space-xs);
}

.cell.selected {
    background-color: var(--cell-selected-color);
}

.cell.dont-care {
    background-color: var(--cell-dont-care-color);
}

.binary-display, .decimal-display {
    font-family: monospace;
    text-align: center;
    user-select: none;
}

.binary-display {
    font-size: var(--font-size-label);
    color: var(--color-text-medium);
    grid-area: botcenter;
    align-self: end;
}

.decimal-display {
    font-size: var(--font-size-body);
    color: var(--kmap-primary);
    grid-area: topleft;
    align-self: start;
    justify-self: start;
}

.center-wrapper {
    display: flex;
    align-items: center;
    justify-content: center;
    grid-area: midcenter;
}

.value-display {
    font-size: var(--font-size-h3);
    font-weight: var(--font-weight-bold);
    user-select: none;
}

.kmap-grid {
    display: grid;
    gap: var(--space-xs);
    margin: 0 auto;
    width: 100%;
    position: relative;
}

/* Truth Table */
.truth-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 2px;
    background-color: var(--color-surface);
}

.truth-table th,
.truth-table td {
    padding: var(--space-xs);
    text-align: center;
    user-select: none;
    background-color: var(--color-surface);
}

.truth-table th {
    background-color: var(--kmap-primary);
    color: white;
    border-radius: var(--radius-md);
}

.truth-table td:last-child {
    font-weight: normal;
    border: var(--stroke-sm) solid var(--color-border-default);
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: all var(--duration-quick) var(--easing);
    background-color: var(--color-surface);
    color: var(--color-text-high);
}

.truth-table td.selected,
.truth-table tr td.selected:last-child {
    background-color: var(--cell-selected-color);
    border-color: var(--cell-selected-color);
}

.truth-table td.dont-care,
.truth-table tr td.dont-care:last-child {
    background-color: var(--cell-dont-care-color);
    border-color: var(--cell-dont-care-color);
}

.truth-table td.row-id {
    background-color: var(--color-surface-hover);
    font-weight: var(--font-weight-bold);
    color: var(--color-text-medium);
    cursor: default;
    border: none;
}

/* UI Elements - Buttons & Controls */
.svg-button {
    border: var(--stroke-sm) solid var(--color-border-default);
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: all var(--duration-quick) var(--easing);
    user-select: none;
    background: var(--color-surface);
    color: var(--color-text-high);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    height: auto;
    min-width: var(--button-min-width);
    padding: var(--space-xs);
    gap: var(--space-xs);
}

.svg-button svg {
    width: 24px;
    height: 24px;
}

.svg-button:disabled,
.svg-button.disabled {
    opacity: 0.1;
    cursor: not-allowed;
    filter: grayscale(100%) blur(0.5px);
    pointer-events: none;
}

/* Dropdown Component (from guidelines) */
.dropdown {
    position: relative;
    display: block;
}

/* Dropdown button for control container - matches svg-button */
.container-control .btn-dropdown {
    display: flex;
    align-items: center;
    justify-content: space-between;
    border: var(--stroke-sm) solid var(--color-border-default);
    border-radius: var(--radius-md);
    background: var(--color-surface);
    color: var(--color-text-high);
    cursor: pointer;
    transition: all var(--duration-quick) var(--easing);
    user-select: none;
    height: 100%;
    width: 100%;
    padding: var(--space-xs);
}

.container-control .btn-dropdown:hover {
    background: var(--color-surface-hover);
    transform: translateY(-1px);
    box-shadow: var(--shadow-md);
}

.container-control .btn-dropdown::after {
    content: '';
    width: 0;
    height: 0;
    border-left: 4px solid transparent;
    border-right: 4px solid transparent;
    border-top: 5px solid currentColor;
    margin-left: var(--space-xs);
}

/* Dropdown button for solution toolbar - matches btn-icon */
.solution-toolbar .btn-dropdown {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0 var(--space-xs);
    min-width: var(--touch-target);
    height: var(--touch-target);
    background-color: transparent;
    border: var(--stroke-sm) solid var(--color-border-default);
    border-radius: var(--radius-md);
    color: var(--color-text-high);
    cursor: pointer;
    transition: all var(--duration-quick) var(--easing);
    white-space: nowrap;
}

.solution-toolbar .btn-dropdown:hover {
    background-color: var(--color-surface-hover);
    border-color: var(--color-text-medium);
}

.solution-toolbar .btn-dropdown::after {
    content: '';
    width: 0;
    height: 0;
    border-left: 4px solid transparent;
    border-right: 4px solid transparent;
    border-top: 5px solid currentColor;
    margin-left: var(--space-xs);
}

.dropdown-menu {
    position: absolute;
    top: calc(100% + var(--space-xs));
    background-color: var(--color-surface);
    border: var(--stroke-sm) solid var(--color-border-default);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-md);
    padding: var(--space-xs);
    min-width: 200px;
    z-index: 50;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-8px);
    transition: opacity var(--duration-medium) var(--easing), transform var(--duration-medium) var(--easing);
}

.container-control .dropdown-menu {
    left: 0;
}

.solution-toolbar .dropdown-menu {
    right: 0;
}

.dropdown-menu.is-visible {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}

.dropdown-item {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    width: 100%;
    padding: var(--space-xs) var(--space-sm);
    border: none;
    background: none;
    text-align: left;
    font: var(--font-label);
    color: var(--color-text-high);
    border-radius: var(--radius-md);
    cursor: pointer;
}

.dropdown-item:hover {
    background-color: var(--color-surface-hover);
}

.dropdown-item:focus-visible {
    outline: var(--stroke-md) solid var(--color-border-focus);
    outline-offset: 2px;
    background-color: var(--color-surface-hover);
}

/* Popup Components */
.overlay-popup {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    backdrop-filter: blur(2px);
}

.overlay-popup.active {
    display: flex;
    justify-content: center;
    align-items: center;
}

.wrapper-popup {
    position: relative;
    max-width: 560px;
    width: 90%;
    transform: scale(0.95);
    opacity: 0;
    transition: transform var(--duration-medium) var(--easing-decelerate), opacity var(--duration-medium) var(--easing-decelerate);
    background: var(--color-surface);
    border: var(--stroke-sm) solid var(--color-border-default);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-lg);
    padding: var(--space-sm);
    max-height: calc(100vh - (var(--space-md) * 2));
    display: flex;
    flex-direction: column;
}

.overlay-popup.active .wrapper-popup {
    transform: scale(1);
    opacity: 1;
}

/* Modal Header */
.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-bottom: var(--space-sm);
    border-bottom: var(--stroke-sm) solid var(--color-border-default);
}

.modal-header h2 {
    margin: 0;
    font: var(--font-h3);
}

.modal-titlebar {
    display: inline-flex;
    align-items: center;
    gap: var(--space-xs);
}

.modal-titlebar img,
.modal-logo {
    height: 32px;
    width: auto;
    display: block;
}

/* Modal Body */
.modal-body {
    padding: var(--space-sm) 0;
    overflow: auto;
    flex: 1 1 auto;
}

.modal-body h3 {
    color: var(--color-text-high);
    margin: 0 0 var(--space-xs) 0;
}

.modal-body h4 {
    color: var(--color-text-high);
    font-weight: var(--font-weight-semibold);
    margin-top: var(--space-sm);
    margin-bottom: var(--space-xs);
}

.modal-body p {
    color: var(--color-text-medium);
    margin-bottom: var(--space-sm);
}

.modal-body ul {
    margin: var(--space-xs) 0;
    padding-left: var(--space-md);
}

.modal-body li {
    margin-bottom: var(--space-xs);
    color: var(--color-text-medium);
}

.modal-body li:last-child {
    margin-bottom: 0;
}

/* Modal Footer */
.modal-footer {
    display: flex;
    justify-content: flex-end;
    gap: var(--space-sm);
    padding-top: var(--space-sm);
    border-top: var(--stroke-sm) solid var(--color-border-default);
}

.modal-footer.has-credit {
    display: grid;
    grid-template-columns: 1fr auto;
    align-items: center;
    gap: var(--space-sm);
}

.footer-credit,
.modal-credit {
    color: var(--color-text-medium);
    font: var(--font-caption);
}

.footer-credit a,
.modal-credit a {
    color: inherit;
    text-decoration: underline;
    text-underline-offset: 2px;
}

@media (max-width: 480px) {
    .modal-footer.has-credit {
        grid-template-columns: 1fr;
        justify-items: stretch;
    }

    .modal-footer.has-credit .btn {
        width: 100%;
        justify-self: stretch;
    }
}

/* Layout toggle button icons */
.icon-layout-binary {
    display: none;
}

.gray-layout .icon-layout-gray {
    display: inline;
}

.gray-layout .icon-layout-binary {
    display: none;
}

.binary-layout .icon-layout-gray {
    display: none;
}

.binary-layout .icon-layout-binary {
    display: inline;
}

/* Theme toggle button icons */
.icon-theme-light,
.icon-theme-dark {
    display: none;
}

[data-theme="light"] .icon-theme-dark {
    display: inline;
}

[data-theme="light"] .icon-theme-light {
    display: none;
}

[data-theme="dark"] .icon-theme-dark {
    display: none;
}

[data-theme="dark"] .icon-theme-light {
    display: inline;
}

/* Settings Grid Layout (matching base-converter) */
.settings-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: var(--space-xs);
}

.settings-grid .btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: var(--space-xs);
    padding: var(--space-sm);
    min-height: 80px;
    text-align: center;
}

.settings-grid .btn svg {
    flex-shrink: 0;
}

.settings-grid .btn.active {
    background-color: var(--color-surface-hover);
    border-color: var(--color-primary);
}

/* Hover States */
@media (hover: hover) {
    .cell:hover {
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
        border-color: var(--kmap-primary-hover);
    }

    .truth-table td:last-child:hover {
        border-color: var(--kmap-primary);
        box-shadow: var(--shadow-md);
        transform: translateY(-1px);
        background-color: var(--color-surface);
    }

    .truth-table td.row-id:hover {
        background-color: var(--color-surface);
        transform: none;
        box-shadow: none;
    }

    .svg-button:hover {
        background: var(--color-surface-hover);
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
    }

    .svg-button:disabled:hover,
    .svg-button.disabled:hover {
        background-color: transparent;
    }

    .btn-popup-close:hover {
        border-color: var(--color-primary);
    }

    #btn-set-ones:hover {
        background: var(--kmap-primary);
        border-color: var(--kmap-primary);
        color: white;
    }

    #btn-set-zeros:hover {
        background-color: var(--color-error);
        border-color: var(--color-error);
        color: white;
    }


    .content-popup a:hover {
        text-decoration: underline;
    }

    .btn-danger:hover {
        background-color: #c82333;
        border-color: #bd2130;
    }
}

/* Ensure all buttons have borders */
.btn,
button {
    border: var(--stroke-sm) solid var(--color-border-default);
}

.btn-primary {
    border-color: var(--color-primary);
}

.btn-secondary {
    border-color: var(--color-border-default);
}

.btn-danger {
    border-color: var(--color-error);
}

.btn-outline {
    border-color: var(--color-border-default);
}
